stages:
  - diff
  - build

variables:
  SOURCE_BRANCH: "test"    # Replace with your source branch
  TARGET_BRANCH: "main"    # Replace with your target branch

diff_job:
  stage: diff
  tags:
    - SonarQube 
  script:
    - echo "Fetching the latest changes..."
    - git fetch origin
    - echo "Switching to source branch test"
    - git checkout $SOURCE_BRANCH
    - echo "Fetching the target branch main"
    - git fetch origin $TARGET_BRANCH
    - echo "Displaying the diff between $SOURCE_BRANCH and $TARGET_BRANCH"
    - git diff remotes/origin/$TARGET_BRANCH remotes/origin/$SOURCE_BRANCH -- '*.java'

build_job:
  stage: build
  tags:
    - SonarQube 
  script:
    - echo ${CI_PROJECT_DIR}
    - echo "Building the project..."
    - ./gradlew clean build --info
